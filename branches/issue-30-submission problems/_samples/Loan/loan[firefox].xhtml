<?xml version="1.0"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ev="http://www.w3.org/2001/xml-events" 
      xmlns:xforms="http://www.w3.org/2002/xforms" 
      xmlns:xsd="http://www.w3.org/2001/XMLSchema"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-Instance">
 <head>
    <meta content="application/xhtml+xml;" http-equiv="content-type" />
    <title>XForms Loan Application Form</title>     
     <xforms:model id="loan_model">
        <xforms:instance id="loan">
        	<LoanRecord xmlns="">
        		<StartDate></StartDate>
        		<Borrower>
        			<Name>John Q. Public</Name>
        			<Addr>123 Main St. Tinyville</Addr>
        		</Borrower>
        		<Principal currency="USD">90000</Principal>
        		<Duration>81</Duration>
        		<InterestRate>7</InterestRate>
        		<Monthly-Payment></Monthly-Payment>
        		<TotalPayout></TotalPayout>
        	</LoanRecord>
        </xforms:instance>

        <xforms:instance id="rate">
	        <rate  xmlns=""></rate>
	    </xforms:instance>
	       
        <xforms:bind nodeset="instance('rate')" 
                     calculate="instance('loan')/InterestRate div 1200.0"/>
               
        <xforms:bind nodeset="TotalPayout" 
                     calculate="../Monthly-Payment * ../Duration" 
                     relevant="../Monthly-Payment &gt; 0 and ../Duration &gt; 0"/>
                            
        <xforms:bind nodeset="Monthly-Payment" 
                     calculate="if(instance('rate') &gt; 0, 
                                   ../Principal * instance('rate') div (1.0 - power(1.0 + instance('rate'), -../Duration)),
                                   ../Principal div ../Duration)"
                     relevant="../Principal > 0 and ../Duration > 0"/>
       	          
        <xforms:bind nodeset="Borrower/Name" required="true()" constraint="string-length(.) > 0"/>
        <xforms:bind nodeset="Borrower/Addr" required="true()" constraint="string-length(.) > 0"/>
        
        <xforms:bind nodeset="Principal"
                     type="xsd:double" 
                     constraint=". &gt;= 1000 and . &lt;= 100000"/>
               
        <xforms:bind nodeset="Duration" 
                     type="xsd:positiveInteger"
                     constraint=". &lt;= 84"/> 

        <xforms:bind nodeset="InterestRate"
                     type="xsd:double" 
                     constraint=". &gt;= 5 and . &lt;= 60"/>
              
        <xforms:bind nodeset="StartDate" type="xsd:date"/>              

 
        <xforms:setvalue ev:event="xforms-ready" 
                         ref="StartDate" 
                         value="if(.='',substring(local-date(),1,10),.)"/>           


        <xforms:submission id="makeLoan" 
                           method="post" 
                           includenamespaceprefixes=""
                           action="http://xformstest.org/cgi-bin/echo.sh"/>

        <!-- This submission simulates a simple server module that bounces submitted
                      data back to the client.  It does so by doing put then get on a file 
                      (the location of which is based on retrieval domain of the form)
                      
               <xforms:submission id="makeLoan" method="put" includenamespaceprefixes=""
                                  replace="none" action="file:poBounce.xml">
                    <xforms:send ev:event="xforms-submit-done" submission="showLoanData"/>
                    <xforms:message ev:event="xforms-submit-error" level="modal">Could not upload file</xforms:message>
               </xforms:submission>
                 
               <xforms:submission id="showLoanData" method="get" action="file:poBounce.xml" replace="all"/>
               
         -->                                  
    </xforms:model>
    <link href="style/gen_default.css" rel="stylesheet"/>
  </head>
  <body>
   
 
    <xforms:output class="company_name"> 
       <xforms:label>Big Red Loan and Mortgage Co.</xforms:label>
    </xforms:output>
      
    <xforms:output class="company_motto"> 
       <xforms:label>The name to trust when you're... in the red.</xforms:label>
    </xforms:output>
      
    <hr size="6" class="rule"/>
      
    <xforms:input ref="/LoanRecord/StartDate"> 
        <xforms:label>Agreement Date: </xforms:label>
    </xforms:input> 

      <xforms:input class="red" ref="Borrower/Name">
         	<xforms:label>Borrower Name:</xforms:label>
         	<xforms:hint>Get the name of the person that's going to receive the money.</xforms:hint>
      </xforms:input>
      
      <xforms:input ref="Borrower/Addr">
          <xforms:label>Borrower's Address:</xforms:label> 
          <xforms:hint>You need to know where the borrower lives so you can visit him if needed.</xforms:hint>
      </xforms:input>
     
      <xforms:input ref="Principal">
          <xforms:label>Principal of Loan:</xforms:label>
          <xforms:hint>Enter the amount of money you will give the borrower.</xforms:hint>
          <xforms:alert>The dollar value must be between 1000 and 100000</xforms:alert>
      </xforms:input>


      <xforms:select1 ref="Principal/@currency" appearance="minimal" incremental="true">
      	<xforms:label>Choose currency</xforms:label>
      	<xforms:item>
      		<xforms:label>US Dollars</xforms:label>
      		<xforms:value>USD</xforms:value>
      	</xforms:item>
      	<xforms:item>
      		<xforms:label>Canadian Dollars</xforms:label>
      		<xforms:value>CDN</xforms:value>
      	</xforms:item>
      	<xforms:item>
      		<xforms:label>Euros</xforms:label>
      		<xforms:value>EUR</xforms:value>
      	</xforms:item>
      </xforms:select1>


      <xforms:input ref="Duration">
             <xforms:label>Duration of Loan in Months:</xforms:label>
             <xforms:hint>Don't give out ol' Big Red's money for longer than seven years!</xforms:hint>
             <xforms:alert>Range is 1 to 84</xforms:alert>
         </xforms:input>
        
         <xforms:input ref="InterestRate" incremental="true">
             <xforms:label>Yearly Interest Rate (compounded monthly):</xforms:label>
             <xforms:hint>We're only loan dogfish, so no more than sixty percent.</xforms:hint>
             <xforms:alert>Choose an interest rate between 5 and 60 percent.</xforms:alert>
         </xforms:input>

     <hr size="6" class="rule"/>
     
     <xforms:output class="regular" ref="Monthly-Payment">
          <xforms:label>Monthly Payment: </xforms:label>
     </xforms:output>
         <!--  styling
         <justify>right</justify>
         <size>
            <width>30</width>
            <height>1</height>
         </size>
         <format>
             <datatype>currency</datatype>
             <presentation>
                 <showcurrency>on</showcurrency>
             </presentation>
         </format>
         -->
      
      <xforms:output class="regular" ref="TotalPayout">
          <xforms:label>Total Payout: </xforms:label>
      </xforms:output>
         <!-- style
         <justify>right</justify>
         <size>
            <width>30</width>
            <height>1</height>
         </size>
         <format>
             <datatype>currency</datatype>
             <presentation>
                 <showcurrency>on</showcurrency>
                 <separator>,</separator>
             </presentation>
         </format>
         -->

      <hr size="6" class="rule"/>
           
    <!-- This submit button connects to a submission -->
	  <xforms:submit submission="makeLoan">
          <xforms:hint>Sends the loan transaction to Big Red</xforms:hint>
          <xforms:label>Submit Loan</xforms:label>
      </xforms:submit>

   </body>
</html>
