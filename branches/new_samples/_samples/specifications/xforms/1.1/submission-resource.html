<?xml version="1.0" encoding="utf-8" ?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xf="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xs="http://www.w3.org/2001/XMLSchema">
	<head>
		<title>Submission using resource</title>
		<script type="text/javascript" src="../../../../ubiquity-loader.js" >/**/</script>
		<link rel="stylesheet" href="../style/sample.css" type="text/css" />
		<style type="text/css">
			xf\:output { display: block; }
		</style>
	</head>
	<body>
		<xf:model id="m">
			<!--
				The first instance manages the data for the Flickr
				query.
			-->
			<xf:instance>
				<instanceData xmlns="">
					<method>flickr.photos.search</method>
					<api_key>68149024a667e0be3c63708f002ffe1e</api_key>
					<tags></tags>
					<per_page>12</per_page>
				</instanceData>
			</xf:instance>
			<!--
				We use this instance to store the results of the request.
			-->
			<xf:instance id="inst-rs">
				<dummy xmlns="" ></dummy>
			</xf:instance>
			<!--
				We use this instance to store other data.
			-->
			<xf:instance id="inst-control">
				<instanceData xmlns="">
					<url ></url>
					<t1 ></t1>
					<t2 ></t2>
					<t3 ></t3>
				</instanceData>
			</xf:instance>
			<!--
				Get some pictures from Flickr tagged with 'london'.
			-->
			<xf:submission id="sub-t1" method="get" resource="http://www.flickr.com/services/rest/" separator="&amp;" replace="instance" instance="inst-rs" mode="synchronous">
				<xf:action ev:event="xforms-submit">
					<xf:setvalue ref="tags" value="'london'" ></xf:setvalue>
					<xf:setvalue ref="instance('inst-control')/t1" value="'submit'" ></xf:setvalue>
				</xf:action>
				<xf:action ev:event="xforms-submit-done">
					<xf:setvalue ref="instance('inst-control')/t1" value="concat(., '|done')" ></xf:setvalue>
					<xf:setvalue if="instance('inst-rs')/@stat='ok'" ref="instance('inst-control')/t1" value="concat(., '|dataok')" ></xf:setvalue>
					<xf:dispatch name="test-complete" target="sub-t1" ></xf:dispatch>
				</xf:action>
				<xf:action ev:event="xforms-submit-error">
					<xf:setvalue ref="instance('inst-control')/t1" value="concat(., '|error')" ></xf:setvalue>
					<xf:dispatch name="test-complete" target="sub-t1" ></xf:dispatch>
				</xf:action>
			</xf:submission>
			<!--
				Use the resource element with a simple string.
			-->
			<xf:submission id="sub-t2" method="get" separator="&amp;" replace="instance"  mode="synchronous" instance="inst-rs">
				<xf:resource value="'http://www.flickr.com/services/rest/'" ></xf:resource>
				<xf:action ev:event="xforms-submit">
					<xf:setvalue ref="tags" value="'brighton'" ></xf:setvalue>
					<xf:setvalue ref="instance('inst-control')/t2" value="'submit'" ></xf:setvalue>
				</xf:action>
				<xf:action ev:event="xforms-submit-done">
					<xf:setvalue ref="instance('inst-control')/t2" value="concat(., '|done')" ></xf:setvalue>
					<xf:setvalue if="instance('inst-rs')/@stat='ok'" ref="instance('inst-control')/t2" value="concat(., '|dataok')" ></xf:setvalue>
					<xf:dispatch name="test-complete" target="sub-t2" ></xf:dispatch>
				</xf:action>
				<xf:action ev:event="xforms-submit-error">
					<xf:setvalue ref="instance('inst-control')/t2" value="concat(., '|error')" ></xf:setvalue>
					<xf:dispatch name="test-complete" target="sub-t2" ></xf:dispatch>
				</xf:action>
			</xf:submission>
			<!--
				Use the resource element with an XPath expression.
			-->
			<xf:submission id="sub-t3" method="get" separator="&amp;"  mode="synchronous" replace="instance" instance="inst-rs">
				<xf:resource value="instance('inst-control')/url" ></xf:resource>
				<xf:action ev:event="xforms-submit">
					<xf:setvalue ref="tags" value="'chicago'" ></xf:setvalue>
					<xf:setvalue ref="instance('inst-control')/url" value="'http://www.flickr.com/services/rest/'" ></xf:setvalue>
					<xf:setvalue ref="instance('inst-control')/t3" value="'submit'" ></xf:setvalue>
				</xf:action>
				<xf:action ev:event="xforms-submit-done">
					<xf:setvalue ref="instance('inst-control')/t3" value="concat(., '|done')" ></xf:setvalue>
					<xf:setvalue if="instance('inst-rs')/@stat='ok'" ref="instance('inst-control')/t3" value="concat(., '|dataok')" ></xf:setvalue>
					<xf:dispatch name="test-complete" target="sub-t3" ></xf:dispatch>
				</xf:action>
				<xf:action ev:event="xforms-submit-error">
					<xf:setvalue ref="instance('inst-control')/t3" value="concat(., '|error')" ></xf:setvalue>
					<xf:dispatch name="test-complete" target="sub-t3" ></xf:dispatch>
				</xf:action>
			</xf:submission>
			<!--
				Chain the tests together
			-->
			<xf:send submission="sub-t1" ev:event="xforms-ready" ></xf:send>
			<xf:send submission="sub-t2" ev:observer="sub-t1" ev:event="test-complete" ></xf:send>
			<xf:send submission="sub-t3" ev:observer="sub-t2" ev:event="test-complete" ></xf:send>
		</xf:model>
		<xf:output id="ready" value="concat('rea', 'dy')" ></xf:output>
		<xf:group ref="instance('inst-control')">
			<xf:output id="t1" ref="t1">
				<xf:label>Test 1:</xf:label>
			</xf:output>
			<xf:output id="t2" ref="t2">
				<xf:label>Test 2:</xf:label>
			</xf:output>
			<xf:output id="t3" ref="t3">
				<xf:label>Test 3:</xf:label>
			</xf:output>
		</xf:group>
	</body>
</html>
