<!--
  * Copyright (C) 2008 Backplane Ltd.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  *  http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
-->
<?xml version="1.0" encoding="iso-8859-1"?>
<html
 xmlns="http://www.w3.org/1999/xhtml"
 xmlns:xf="http://www.w3.org/2002/xforms"
>
	<head>
		<title>Using the XForms 1.1 hmac function</title>
		<script type="text/javascript" src="../../../../ubiquity-loader.js" >/**/</script>
		<style type="text/css">
			xf\:output { display: block; }
		</style>
	</head>
	<body>
		<xf:model>
			<xf:instance>
				<instanceData xmlns="">
					<function_shared_secret>alphabet</function_shared_secret>
					<function_input>abc</function_input>
					<node id="md5-hex" ></node>
					<node id="md5-b64" ></node>
					<node id="sha1-hex" ></node>
					<node id="sha1-b64" ></node>
					<node id="sha256-hex" ></node>
					<node id="sha256-b64" ></node>
					<node id="sha385-hex" ></node>
					<node id="sha385-b64" ></node>
					<node id="sha512-hex" ></node>
					<node id="sha512-b64" ></node>
				</instanceData>
			</xf:instance>
			
			<xf:bind nodeset="/instanceData">
				<xf:bind nodeset="node[@id = 'md5-hex']"	calculate="hmac(../function_shared_secret, ../function_input, 'md5', 'hex')" ></xf:bind>
				<xf:bind nodeset="node[@id = 'md5-b64']"	calculate="hmac(../function_shared_secret, ../function_input, 'md5', 'base64')" ></xf:bind>
				<xf:bind nodeset="node[@id = 'sha1-hex']"	calculate="hmac(../function_shared_secret, ../function_input, 'sha1', 'hex')" ></xf:bind>
				<xf:bind nodeset="node[@id = 'sha1-b64']"	calculate="hmac(../function_shared_secret, ../function_input, 'sha1', 'base64')" ></xf:bind>
				<xf:bind nodeset="node[@id = 'sha256-hex']"	calculate="hmac(../function_shared_secret, ../function_input, 'sha256', 'hex')" ></xf:bind>
				<xf:bind nodeset="node[@id = 'sha256-b64']"	calculate="hmac(../function_shared_secret, ../function_input, 'sha256', 'base64')" ></xf:bind>
				<xf:bind nodeset="node[@id = 'sha384-hex']"	calculate="hmac(../function_shared_secret, ../function_input, 'sha384', 'hex')" ></xf:bind>
				<xf:bind nodeset="node[@id = 'sha384-b64']"	calculate="hmac(../function_shared_secret, ../function_input, 'sha384', 'base64')" ></xf:bind>
				<xf:bind nodeset="node[@id = 'sha512-hex']"	calculate="hmac(../function_shared_secret, ../function_input, 'sha512', 'hex')" ></xf:bind> 
				<xf:bind nodeset="node[@id = 'sha512-b64']"	calculate="hmac(../function_shared_secret, ../function_input, 'sha512', 'base64')" ></xf:bind>
			</xf:bind>
		</xf:model>
		
		<xf:output id="ready" value="concat('rea', 'dy')" style="display: none;" ></xf:output>

		<a href="http://www.w3.org/TR/xforms11/#fn-hmac">http://www.w3.org/TR/xforms11/#fn-hmac</a>

		<h1>Literal values</h1>

		<!-- 
			MD5 hex. 
			Should return: 24840f04f86709fdabc580e64dc40e8f
		-->
		<xf:output id="t2a" value="hmac('alphabet', 'abc', 'md5', 'hex')">
			<xf:label>Test 2a:</xf:label>
		</xf:output>
		
		<!-- MD5 base 64. Should return: ? -->
		<xf:output id="t2a1" value="hmac('alphabet', 'abc', 'md5', 'base64')">
			<xf:label>Test 2a1:</xf:label>
		</xf:output>
		
		<!-- 
			SHA1 hex. 
			Should return 12dc4ca664cc4055a208d7fac322cab263bd9fc8
		-->
		<xf:output id="t2b" value="hmac('alphabet', 'abc', 'sha1', 'hex')">
			<xf:label>Test 2b:</xf:label>
		</xf:output>
		
		<!-- SHA1 base64.  -->
		<xf:output id="t2b1" value="hmac('alphabet', 'abc', 'sha1', 'base64')">
			<xf:label>Test 2b1:</xf:label>
		</xf:output>
		
		<!-- 
			SHA256 hex. 
			Should return 5696573b7ea452fa3fc31e2b6d15bcf8c2352f039799e888f71b661a035c242d
		-->
		<xf:output id="t2c" value="hmac('alphabet', 'abc', 'sha256', 'hex')">
			<xf:label>Test 2c:</xf:label>
		</xf:output>
		
		<!-- SHA256 base64. -->
		<xf:output id="t2c1" value="hmac('alphabet', 'abc', 'sha256', 'base64')">
			<xf:label>Test 2c1:</xf:label>
		</xf:output>
		
		<!-- 
			SHA384 hex. 
			Should return f5c7d49e6ef244fb82229ba0596dc272334a9f37f3a4ed12e46226501ca39adb34a3bd6235f7c7f3a65797f2d212a774
		-->
		<xf:output id="t2d" value="hmac('alphabet', 'abc', 'sha384', 'hex')">
			<xf:label>Test 2d:</xf:label>
		</xf:output>
		
		<!-- SHA384 base64. -->
		<xf:output id="t2d1" value="hmac('alphabet', 'abc', 'sha384', 'base64')">
			<xf:label>Test 2d1:</xf:label>
		</xf:output>
		
		<!-- 
			SHA512 hex. 
			Should return b6fe6f2a57bf32ca7abb277353aba4549f6b47a240c8ba8f7d6490e4bd049c6a734ed47b9e2e116b9a4de087a8cc2175ca66d071468afb01f76c01215f401954
		-->
		<xf:output id="t2e" value="hmac('alphabet', 'abc', 'sha512', 'hex')">
			<xf:label>Test 2e:</xf:label>
		</xf:output>
		
		<!-- SHA512 base64. -->
		<xf:output id="t2e1" value="hmac('alphabet', 'abc', 'sha512', 'base64')">
			<xf:label>Test 2e1:</xf:label>
		</xf:output>
		
		<h1>Referenced values</h1>
		
		<!-- MD5 hex. -->
		<xf:output id="t2f" ref="/instanceData/node[@id = 'md5-hex']">
			<xf:label>Test 2f:</xf:label>
		</xf:output>
		
		<!-- MD5 base64 -->
		<xf:output id="t2f1" ref="/instanceData/node[@id = 'md5-b64']">
			<xf:label>Test 2f1:</xf:label>
		</xf:output>
		
		<!-- SHA1 hex. -->
		<xf:output id="t2g" ref="/instanceData/node[@id = 'sha1-hex']">
			<xf:label>Test 2g:</xf:label>
		</xf:output>
		
		<!-- SHA1 base64. -->
		<xf:output id="t2g1" ref="/instanceData/node[@id = 'sha1-b64']">
			<xf:label>Test 2g1:</xf:label>
		</xf:output>
		
		<!-- SHA256 hex. -->
		<xf:output id="t2h" ref="/instanceData/node[@id = 'sha256-hex']">
			<xf:label>Test 2h:</xf:label>
		</xf:output>
		
		<!-- SHA256 base64. -->
		<xf:output id="t2h1" ref="/instanceData/node[@id = 'sha256-b64']">
			<xf:label>Test 2h1:</xf:label>
		</xf:output>
		
		<!-- SHA384 hex. -->
		<xf:output id="t2i" ref="/instanceData/node[@id = 'sha384-hex']">
			<xf:label>Test 2i:</xf:label>
		</xf:output>
		
		<!-- SHA384 base64. -->
		<xf:output id="t2i1" ref="/instanceData/node[@id = 'sha384-b64']">
			<xf:label>Test 2i1:</xf:label>
		</xf:output>
		
		<!-- SHA512 hex. -->
		<xf:output id="t2j" ref="/instanceData/node[@id = 'sha512-hex']">
			<xf:label>Test 2j:</xf:label>
		</xf:output>
		
		<!-- SHA512 base64. -->
		<xf:output id="t2j1" ref="/instanceData/node[@id = 'sha512-b64']">
			<xf:label>Test 2j1:</xf:label>
		</xf:output>
	</body>
</html>