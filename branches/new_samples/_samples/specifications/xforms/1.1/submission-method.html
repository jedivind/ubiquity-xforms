<!--
  * Copyright (C) 2008 Backplane Ltd.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  *  http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
-->
<?xml version="1.0" encoding="utf-8" ?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xf="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <head>
    <title>Submission using method</title>
	<script type="text/javascript" src="../../../../ubiquity-loader.js" >/**/</script>
    <link rel="stylesheet" href="../style/sample.css" type="text/css" />
    <style type="text/css">
      xf\:output { display: block; }
    </style>
  </head>
  <body>
    <xf:model id="m">
      <!--
        The first instance manages the data for the Flickr
        query.
      -->
      <xf:instance>
        <instanceData xmlns="">
          <method>flickr.photos.search</method>
          <api_key>68149024a667e0be3c63708f002ffe1e</api_key>
          <tags></tags>
          <per_page>12</per_page>
        </instanceData>
      </xf:instance>
      <!--
        We use this instance to store the results of the request.
      -->
      <xf:instance id="inst-rs">
        <dummy xmlns="" ></dummy>
      </xf:instance>
      <!--
        We use this instance to store other data.
      -->
      <xf:instance id="inst-control">
        <instanceData xmlns="">
          <method ></method>
          <t1 ></t1>
          <t2 ></t2>
          <t3 ></t3>
          <t4 ></t4>
          <t5 ></t5>
          <t6 ></t6>
        </instanceData>
      </xf:instance>
      <!--
        Get some pictures from Flickr tagged with 'london'.
      -->
      <xf:submission id="sub-t1" method="get" resource="http://api.flickr.com/services/rest/" separator="&amp;" replace="instance" instance="inst-rs" mode="synchronous">
        <xf:action ev:event="xforms-submit">
          <xf:setvalue ref="tags" value="'london'" ></xf:setvalue>
          <xf:setvalue ref="instance('inst-control')/t1" value="'submit'" ></xf:setvalue>
        </xf:action>
        <xf:action ev:event="xforms-submit-done">
          <xf:setvalue ref="instance('inst-control')/t1" value="concat(., '|done')" ></xf:setvalue>
          <xf:setvalue if="instance('inst-rs')/@stat='ok'" ref="instance('inst-control')/t1" value="concat(., '|dataok')" ></xf:setvalue>
          <xf:dispatch name="test-complete" target="sub-t1" ></xf:dispatch>
        </xf:action>
        <xf:action ev:event="xforms-submit-error">
          <xf:setvalue ref="instance('inst-control')/t1" value="concat(., '|error')" ></xf:setvalue>
          <xf:dispatch name="test-complete" target="sub-t1" ></xf:dispatch>
        </xf:action>
      </xf:submission>
      <!--
        Use the method element with a simple string.
      -->
      <xf:submission id="sub-t2" resource="http://api.flickr.com/services/rest/" separator="&amp;" replace="instance" instance="inst-rs" mode="synchronous">
        <xf:method value="'get'" ></xf:method>
        <xf:action ev:event="xforms-submit">
          <xf:setvalue ref="tags" value="'brighton'" ></xf:setvalue>
          <xf:setvalue ref="instance('inst-control')/t2" value="'submit'" ></xf:setvalue>
        </xf:action>
        <xf:action ev:event="xforms-submit-done">
          <xf:setvalue ref="instance('inst-control')/t2" value="concat(., '|done')" ></xf:setvalue>
          <xf:setvalue if="instance('inst-rs')/@stat='ok'" ref="instance('inst-control')/t2" value="concat(., '|dataok')" ></xf:setvalue>
          <xf:dispatch name="test-complete" target="sub-t2" ></xf:dispatch>
        </xf:action>
        <xf:action ev:event="xforms-submit-error">
          <xf:setvalue ref="instance('inst-control')/t2" value="concat(., '|error')" ></xf:setvalue>
          <xf:dispatch name="test-complete" target="sub-t2" ></xf:dispatch>
        </xf:action>
      </xf:submission>
      <!--
        Use the method element with a string in the content.
      -->
      <xf:submission id="sub-t3" resource="http://api.flickr.com/services/rest/" separator="&amp;"  mode="synchronous" replace="instance" instance="inst-rs">
        <xf:method>get</xf:method>
        <xf:action ev:event="xforms-submit">
          <xf:setvalue ref="tags" value="'chicago'" ></xf:setvalue>
          <xf:setvalue ref="instance('inst-control')/method" value="'get'" ></xf:setvalue>
          <xf:setvalue ref="instance('inst-control')/t3" value="'submit'" ></xf:setvalue>
        </xf:action>
        <xf:action ev:event="xforms-submit-done">
          <xf:setvalue ref="instance('inst-control')/t3" value="concat(., '|done')" ></xf:setvalue>
          <xf:setvalue if="instance('inst-rs')/@stat='ok'" ref="instance('inst-control')/t3" value="concat(., '|dataok')" ></xf:setvalue>
          <xf:dispatch name="test-complete" target="sub-t3" ></xf:dispatch>
        </xf:action>
        <xf:action ev:event="xforms-submit-error">
          <xf:setvalue ref="instance('inst-control')/t3" value="concat(., '|error')" ></xf:setvalue>
          <xf:dispatch name="test-complete" target="sub-t3" ></xf:dispatch>
        </xf:action>
      </xf:submission>
      <!--
        Use the method element with an XPath expression.
      -->
      <xf:submission id="sub-t4" resource="http://api.flickr.com/services/rest/" separator="&amp;" replace="instance" instance="inst-rs" mode="synchronous">
        <xf:method value="instance('inst-control')/method" ></xf:method>
        <xf:action ev:event="xforms-submit">
          <xf:setvalue ref="tags" value="'london'" ></xf:setvalue>
          <xf:setvalue ref="instance('inst-control')/t4" value="'submit'" ></xf:setvalue>
        </xf:action>
        <xf:action ev:event="xforms-submit-done">
          <xf:setvalue ref="instance('inst-control')/t4" value="concat(., '|done')" ></xf:setvalue>
          <xf:setvalue if="instance('inst-rs')/@stat='ok'" ref="instance('inst-control')/t4" value="concat(., '|dataok')" ></xf:setvalue>
          <xf:dispatch name="test-complete" target="sub-t4" ></xf:dispatch>
        </xf:action>
        <xf:action ev:event="xforms-submit-error">
          <xf:setvalue ref="instance('inst-control')/t4" value="concat(., '|error')" ></xf:setvalue>
          <xf:dispatch name="test-complete" target="sub-t4" ></xf:dispatch>
        </xf:action>
      </xf:submission>
      <!--
        Check that the method element takes precedence over @method.
      -->
      <xf:submission id="sub-t5" method="delete" resource="http://api.flickr.com/services/rest/" separator="&amp;" replace="instance" instance="inst-rs" mode="synchronous">
        <xf:method value="'get'" ></xf:method>
        <xf:action ev:event="xforms-submit">
          <xf:setvalue ref="tags" value="'san francisco'" ></xf:setvalue>
          <xf:setvalue ref="instance('inst-control')/t5" value="'submit'" ></xf:setvalue>
        </xf:action>
        <xf:action ev:event="xforms-submit-done">
          <xf:setvalue ref="instance('inst-control')/t5" value="concat(., '|done')" ></xf:setvalue>
          <xf:setvalue if="instance('inst-rs')/@stat='ok'" ref="instance('inst-control')/t5" value="concat(., '|dataok')" ></xf:setvalue>
          <xf:dispatch name="test-complete" target="sub-t5" ></xf:dispatch>
        </xf:action>
        <xf:action ev:event="xforms-submit-error">
          <xf:setvalue ref="instance('inst-control')/t5" value="concat(., '|error')" ></xf:setvalue>
          <xf:dispatch name="test-complete" target="sub-t5" ></xf:dispatch>
        </xf:action>
      </xf:submission>
      <!--
        Check that @value takes precedence over content.
      -->
      <xf:submission id="sub-t6" resource="http://api.flickr.com/services/rest/" separator="&amp;" replace="instance" instance="inst-rs" mode="synchronous">
        <xf:method value="'get'">delete</xf:method>
        <xf:action ev:event="xforms-submit">
          <xf:setvalue ref="tags" value="'newcastle'" ></xf:setvalue>
          <xf:setvalue ref="instance('inst-control')/t6" value="'submit'" ></xf:setvalue>
        </xf:action>
        <xf:action ev:event="xforms-submit-done">
          <xf:setvalue ref="instance('inst-control')/t6" value="concat(., '|done')" ></xf:setvalue>
          <xf:setvalue if="instance('inst-rs')/@stat='ok'" ref="instance('inst-control')/t6" value="concat(., '|dataok')" ></xf:setvalue>
          <xf:dispatch name="test-complete" target="sub-t6" ></xf:dispatch>
        </xf:action>
        <xf:action ev:event="xforms-submit-error">
          <xf:setvalue ref="instance('inst-control')/t6" value="concat(., '|error')" ></xf:setvalue>
          <xf:dispatch name="test-complete" target="sub-t6" ></xf:dispatch>
        </xf:action>
      </xf:submission>
      <!--
        Chain the tests together
      -->
      <xf:send submission="sub-t1" ev:event="xforms-ready" ></xf:send>
      <xf:send submission="sub-t2" ev:observer="sub-t1" ev:event="test-complete" ></xf:send>
      <xf:send submission="sub-t3" ev:observer="sub-t2" ev:event="test-complete" ></xf:send>
      <xf:send submission="sub-t4" ev:observer="sub-t3" ev:event="test-complete" ></xf:send>
      <xf:send submission="sub-t5" ev:observer="sub-t4" ev:event="test-complete" ></xf:send>
      <xf:send submission="sub-t6" ev:observer="sub-t5" ev:event="test-complete" ></xf:send>
    </xf:model>
    <xf:output id="ready" value="concat('rea', 'dy')" ></xf:output>
    <xf:group ref="instance('inst-control')">
      <xf:output id="t1" ref="t1">
        <xf:label>Test 1:</xf:label>
      </xf:output>
      <xf:output id="t2" ref="t2">
        <xf:label>Test 2:</xf:label>
      </xf:output>
      <xf:output id="t3" ref="t3">
        <xf:label>Test 3:</xf:label>
      </xf:output>
      <xf:output id="t4" ref="t4">
        <xf:label>Test 4:</xf:label>
      </xf:output>
      <xf:output id="t5" ref="t5">
        <xf:label>Test 5:</xf:label>
      </xf:output>
      <xf:output id="t6" ref="t6">
        <xf:label>Test 6:</xf:label>
      </xf:output>
    </xf:group>
  </body>
</html>
