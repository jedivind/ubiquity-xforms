<!--
  * Copyright (C) 2008 Backplane Ltd.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  *  http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
-->
<?xml version="1.0" encoding="iso-8859-1"?>
<html
 xmlns="http://www.w3.org/1999/xhtml"
 xmlns:xf="http://www.w3.org/2002/xforms"
>
	<head>
		<title>Using the XForms 1.1 luhn function</title>
		<script type="text/javascript" src="../../../../ubiquity-loader.js" >/**/</script>
		<style type="text/css">
			xf\:output { display: block; }
			xf\:label { width: 100px;}
		</style>
	</head>
	<body>
		<xf:model>
			<xf:instance>
				<instanceData xmlns="">
					<number id="valid">4111111111111111</number>
					<number id="invalid">9999999999999999</number>
					<number id="too-short">11111111111</number>
					<number id="too-long">44444111111111111111</number>
					<number id="bad-char">X111111111111111</number>
				</instanceData>
			</xf:instance>
			
			<xf:bind 
				nodeset="/instanceData/number"
				type="xf:ID-card-number" 
				constraint="luhn(.)"
			></xf:bind>
		</xf:model>
		
		<xf:output id="ready" value="concat('rea', 'dy')" style="display: none;" ></xf:output>

		<a href="http://www.w3.org/TR/xforms11/#fn-luhn">http://www.w3.org/TR/xforms11/#fn-luhn</a>

		<!-- 
			To test:
			- @type ok
			- not conformant to formula
			- too short < 12 digits
			- too long > 19 digits
			- character not in [0-9]
		-->

		<h1>Literal values</h1>
		
		<!-- valid -->
		<xf:output id="t2a" value="luhn('4111111111111111')">
			<xf:label>Test 2a:</xf:label>
		</xf:output>

		<!-- invalid (not conformant to formula) -->
		<xf:output id="t2b" value="luhn('9999999999999999')">
			<xf:label>Test 2b:</xf:label>
		</xf:output>

		<!-- invalid (too short) -->
		<xf:output id="t2c" value="luhn('11111111111')">
			<xf:label>Test 2c:</xf:label>
		</xf:output>
	
		<!-- invalid (too long) -->
		<xf:output id="t2d" value="luhn('44444111111111111111')">
			<xf:label>Test 2c:</xf:label>
		</xf:output>
		
		<!-- invalid (bad char) -->
		<!-- 
			Doesn't return true or false, just gives a fatal error pop-up.
		-->
		<!-- xf:output id="t2e" value="luhn('X111111111111111')">
			<xf:label>Test 2c:</xf:label>
		</xf:output -->

		<h1>Referenced values</h1>

		<!-- valid -->
		<xf:output id="t2f" value="luhn(/instanceData/number[@id = 'valid'])">
			<xf:label>Test (valid)</xf:label>
		</xf:output>

		<!-- invalid (not conformant to formula) -->
		<xf:output id="t2g" value="luhn(/instanceData/number[@id = 'invalid'])">
			<xf:label>Test (invalid)</xf:label>
		</xf:output>

		<!-- invalid (too short) -->
		<xf:output id="t2h" value="luhn(/instanceData/number[@id = 'too-short'])">
			<xf:label>Test (too short)</xf:label>
		</xf:output>
		
		<!-- invalid (too long) -->
		<xf:output id="t2i" value="luhn(/instanceData/number[@id = 'too-long'])">
			<xf:label>Test(too long)</xf:label>
		</xf:output>
		
		<!-- invalid (bad char) -->
		<!-- 
			Doesn't return true or false, just gives a fatal error pop-up.
		-->
		<!-- xf:output id="t2j" value="luhn(/instanceData/number[@id = 'bad-char'])">
			<xf:label>Test (bad char)</xf:label>
		</xf:output -->
	</body>
</html>