<!--
  * Copyright (C) 2008 Backplane Ltd.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  *  http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
-->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html 
	xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:fp="urn:formsplayer.com" 
	xmlns:ev="http://www.w3.org/2001/xml-events"
	xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<title>Searching Amazon</title>
		<script type="text/javascript" src="../../../ubiquity-loader.js" >/**/</script>	

		<style type="text/css">
			body {
				font-family			:	"Trebuchet MS", Verdana, Helvetica, sans-serif;
			}
			
			h2 {
				background-color	:	lightblue;
				font-size			:	80%;
			}
			
			.the-demo {
				background-color	:	lightyellow;
				border				:	1px thin solid darkyellow;
				padding				:	5px;
			}			
			
			/* xf:repeat control */
			xf\:repeat
			{
				display		:	block;
				border-top	:	1px thin solid black;
			}

			/* each row in the xf:repeat */
			.repeat-item
			{
				display		:	block;
				padding		:	5px;
			}

			/* currently selected row in the xf:repeat */
			.repeat-index { 
				background-color	:	lightblue;
			}
		</style>
	</head>
	<body>
		<xf:model id="mQuery">
			<!--
				Instance data to submit to Amazon to do the search

				If you plan on doing any serious work with the Amazon web
				service then you'll need to get your own key to go in
				<dev-t>, below.
			-->
			<xf:instance id="iQuery">
				<instanceData xmlns="">
					<t>webservices-20</t>
					<dev-t>D1723OX2631XW0</dev-t>
					<KeywordSearch>xforms</KeywordSearch>
					<mode>books</mode>
					<type>lite</type>
					<page>1</page>
					<f>xml</f>
				</instanceData>
			</xf:instance>

			<!--
				Empty instance to pick up the search results
			-->
			<xf:instance id="iResults">
				<instanceData xmlns=""></instanceData>
			</xf:instance>

			<!--
				A named nodeset, to make it easier to refer to the
				search results later (it's dynamic, of course)
			-->
			<xf:bind id="bndResults" nodeset="instance('iResults')/Details"></xf:bind>

			<!--
				Do the search, and put the results in the instance. Note
				that the first thing we have to do is copy the
				search criteria so we can re-use it if we want
			-->
			<xf:submission id="subAmazonQuery" action="http://xml.amazon.com/onca/xml3" method="get" separator="&amp;" ref="instance('iQuery')" replace="instance" instance="iResults" omit-xml-declaration="yes"></xf:submission>

			<!--
				The same search as above, but this replaces the whole
				document with the XML results. It's useful for testing,
				and also for finding out what data is available for
				rendering to the user
			-->
			<xf:submission id="subTestAmazonQuery" action="http://xml.amazon.com/onca/xml3" method="get" separator="&amp;" ref="instance('iQuery')" replace="all"></xf:submission>
		</xf:model>

		<xf:model id="mStrings">
			<!--
				Localisation of help and control labels. Note
				that to use embedded markup it must be 'escaped'
			-->
			<xf:instance id="iStrings">
				<strings xmlns="">
					<string el="KeywordSearch" type="help">
						A &lt;i&gt;keyword&lt;/i&gt; is a general search term that is used to find products in the
						&lt;a href="http://www.amazon.com/"&gt;Amazon.com&lt;/a&gt; catalog. Often, more
						than one keyword is used at the same time to form a short phrase (such
						as "finance software").
					</string>
					<string el="KeywordSearch" type="label">
						Keyword (Press 'F1' for help):
					</string>
				</strings>
			</xf:instance>
		</xf:model>
		<h1>
			Searching Amazon
		</h1>
		<div>
			A search is performed on Amazon and the results used to populate a &lt;repeat&gt; 
			with information about the book and a picture of its cover.
		</div>
		<div>
			<h2>This demo also illustrates:</h2>
			<ul>
				<li>styling <code>hint</code>s;</li>
				<li>
					obtaining <code>hint</code> and <code>help</code> from
					instance data;
				</li>
				<li>using mark-up within <code>hint</code> and <code>help</code>;</li>
				<li>styling <code>::repeat-item</code> and <code>::repeat-index</code>;</li>
				<li>and using <code>load</code>.</li>
			</ul>
		</div>
		<div>
			<h2>To use this demo:</h2>
			<ol>
				<li>Enter a search term.</li>
				<li>Press <code>[F1]</code> whilst in the search field, to see help.</li>
				<li>Press <code>[Search Amazon]</code> to see a list of results.</li>
				<li>
					Each result should show a small version of the book cover,
					and the title of the book.
				</li>
				<li>Hover over the book cover to see a large version of it.</li>
				<li>Click on the book title to load the Amazon page into a new window.</li>
			</ol>
		</div>
		<div class="the-demo">
     		<!--
     			Get the user's search term - note that the label and help text
     			come from instance data. The same technique could easily be used
     			to put the text into other languages.
     		-->
     		<xf:input model="mQuery" ref="KeywordSearch">
     			<xf:label model="mStrings" ref="instance('iStrings')/string[@el='KeywordSearch' and @type='label']"></xf:label>
     			<xf:help model="mStrings" ref="instance('iStrings')/string[@el='KeywordSearch' and @type='help']"></xf:help>
     		</xf:input>
     		<hr/>
     
     		<!--
     			This will do the proper search
     			Note that the hint has width and height
     
     			BUG: Width cannot currently be set on hints.
     		-->
     		<xf:submit submission="subAmazonQuery">
     			<xf:label>Search Amazon</xf:label>
     			<xf:hint style="width: 100px; height: 100px;">
     				Let's search ... (note that style is
     				set on this hint to control height
     				and width)
     			</xf:hint>
     		</xf:submit>
     
     		<!--
     			This will search and replace the document
     			Note that the hint has width and format,
     			although not all style can be controlled in
     			fP 1.0.
     		-->
     		<xf:submit submission="subTestAmazonQuery">
     			<xf:label>Show results as XML</xf:label>
     			<xf:hint style="width: 200px; color: blue;">
     				This will do <code>@replace="all"</code> to
     				test the query (note that style is set
     				on this hint to control the width and
     				the foreground colour, and that we
     				have embedded mark-up)
     			</xf:hint>
     		</xf:submit>
     
     		<!--
     			Show the results - use the named nodeset (<bind>)
     			that we prepared earlier.
     
     			Note what happens without any coding:
     
     			* iteration of the nodelist, regardless of size;
     			* dynamic changes if the instance data changes (for example
     			  a new search is initiated);
     			* CSS on the items repeated over, and the
     			  currently selected item in a repeat.
     		-->
     		<xf:repeat bind="bndResults">
     			<!--
     				Concatenating mark-up gives us the image from the returned data.
     				Note that in X-Smiles this will just output a string of mark-up,
     				but a cross-platform solution will be available in XForms 1.1.
     			-->
     			<xf:output value="concat('&lt;img src=&quot;', ImageUrlSmall, '&quot; /&gt;')">
     				<xf:hint>
     					<xf:output value="concat('&lt;img src=&quot;', ImageUrlLarge, '&quot; /&gt;')"></xf:output>
     				</xf:hint>
     			</xf:output>
     
     			<xf:trigger appearance="minimal" style="cursor: hand;">
     				<xf:label ref="ProductName"></xf:label>
     				<xf:hint>
     					Click to open another window containing the
     					Amazon page for <em>'<xf:output ref="ProductName"></xf:output>'</em>
     				</xf:hint>
     				<xf:load ev:event="DOMActivate" ref="@url" show="new"></xf:load>
     			</xf:trigger>
     		</xf:repeat>
		</div>
	</body>
</html>