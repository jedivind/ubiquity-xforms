#summary Notes about creating a BuildBot slave on Windows.
#labels Phase-QA

= Introduction =

It's fairly straightforward to create a Buildbot slave that will connect to the Ubiquity XForms Buildbot master. This page captures notes on the process, and will apply to any Buildbot slave. If you specifically want to set up a slave that talks to the Ubiquity XForms master then you'll need to obtain a slave name, and let us know the user-name and password. You'll also need to decide what it is that you are going to test, so that the Buildbot master can send the correct commands to your slave.

You can do all of this by contacting [mailto:mark.birbeck@webBackplane.com Mark Birbeck].

= Details =

== Install Python ==

The latest versions of Python are on the [http://www.python.org/download/ Python download page]. The Windows installers for version 2.x are recommended over version 3 installers. At the time of writing the latest was version 2.6.1.

Add the Python (`c:\Python26\`) and Python scripts (`c:\Python26\Scripts\`) directories to `PATH` in the environment variables.

Also add `.PY` to `PATHEXT`.

Open a new command prompt (an existing one won't have the new entries in the environment variables) and verify that you can run Python:
{{{
python --version
}}}

You should see version 2.6.1, but if you don't, type `set` and ensure that the changes to `PATH` and `PATHEXT` are showing up.

== Install Twisted ==

The latest versions of Twisted are on the [http://twistedmatrix.com/trac/ Twisted Matrix Labs trac page]. Choose a version of Twisted that matches the version of Python installed in the previous step, which in this case is Twisted 8.2.0 for Python 2.6.

Open a new command prompt and verify that you can run Twisted:
{{{
trial --version
}}}

You should see version 8.2.0.

== Install Python Extensions for Windows ==

The latest versions of !PyWin32 are on the [http://sourceforge.net/project/platformdownload.php?group_id=78018&sel_platform=3212 pywin32 Sourceforge.net page]. Choose a version that matches the version of Python installed in the first step, which in this case is !PyWin32 build 212 for Python 2.6.

== Install Buildbot ==

ASCEND has a [http://ascendwiki.cheme.cmu.edu/images/0/0f/Buildbot-0.7.6.win32.exe Windows installer] that installs Buildbot. It's only version 0.7.6 but it seems to work ok.

Once Buildbot is installed, the `buildbot.bat` file in the Python scripts directory will need to be edited to point to the installed version of Python. Assuming that Python 2.6 is being used, then the file will be found here:
{{{
c:\Python26\scripts\buildbot.bat
}}}
and will contain this:
{{{
@python C:\Python23\Scripts\buildbot %*
}}}
which should be changed to:
{{{
@python C:\Python26\Scripts\buildbot %*
}}}

Next, the Buildbot startup file -- `startup.py` -- needs to be modified due to a problem with Twisted. The file should be here:
{{{
c:\Python26\Lib\site-packages\buildbot\scripts\startup.py
}}}
Replace the lines beginning at line 108, with:
{{{
        if platformType == "win32":
            try:
                from twisted.scripts._twistw import run
            except ImportError:
                from twisted.scripts.twistd import run
        else:
            from twisted.scripts.twistd import run
        run()
}}}

Verify that you can run Buildbot:
{{{
buildbot --version
}}}
You should see that Buildbot has version 0.7.6, and that Twisted has version 8.2.0.

Create a directory to hold the Buildbot slave (or slaves) at:
{{{
c:\Documents and Settings\buildbot
}}}

== Install SVN ==

The latest versions of SVN for Windows are available from the [http://subversion.tigris.org/servlets/ProjectDocumentList?folderID=91 Tigris.org Windows download page]. Use the latest MSI that contains the basic Win32 binaries (currently 1.5.3).

== Install Apache Ant ==

The latest version of Apache Ant is available from the [http://ant.apache.org/bindownload.cgi Apache Ant binary distribution page]. Download the ZIP file for the latest version, currently 1.7.1, and extract to the root directory. Then rename the directory to `c:\ant`.

Add `c:\ant\bin` as `ANT_HOME` to the environment variables, and then add `%ANT_HOME%` to `PATH`.

Open a new command prompt (an existing one won't have the new entries in the environment variables) and verify that you can run Ant:
{{{
ant -version
}}}
You should see version 1.7.1.

== Create the slave ==

Change directory to the Buildbot directory created above (`c:\Documents and Settings\buildbot`), and type the following command:
{{{
buildbot create-slave full ec2-174-129-107-106.compute-1.amazonaws.com:9989 win32-full password
}}}
The server name and port number are fixed, because they represent the Ubiquity XForms master. The slave name and password (the last two parameters) will have been agreed at the beginning (see _Introduction_, above). The directory into which to install the slave files is set to `full` and is relative to the current directory.

Assuming all is well, a number of lines of output will be displayed, indicating that the files have been created correctly.

== Launch the slave ==

To launch the slave, stay in the Buildbot directory (`c:\Documents and Settings\buildbot`) and type:
{{{
buildbot start full
}}}
or alternatively, change into the `full` directory (`c:\Documents and Settings\buildbot\full`) and type:
{{{
buildbot start .
}}}
After a short wait the list of slaves should include the freshly added slave:
{{{
http://ec2-174-129-107-106.compute-1.amazonaws.com:8080/buildslaves
}}}
If the slave has been added correctly then it should show up in the list with the comment _Slave is currently connected_.

To check the admin and host information that was added, look for the slave on its corresponding builder's page. For example, if the slave had been added to the builder `full-ie7-test` then its details should show up here:
{{{
http://ec2-174-129-107-106.compute-1.amazonaws.com:8080/builders/full-ie7-test
}}}

= Testing Firefox =

Install Firefox onto the slave machine. The latest stable version is always available from the [http://firefox.com Firefox home-page]. Make sure not to tick 'make this my default browser', if you also plan to test with Internet Explorer on the same machine.

If you are using FF3 then it needs to be told to allow local files to be regarded as coming from the 'same origin'. To do this, navigate to:
{{{
about:config
}}}
and acknowledge the warning. When the list of options is shown, filter on:
{{{
strict_origin_policy
}}}
You should be left with one option:
{{{
security.fileuri.strict_origin_policy
}}}
If it is already set to `false` then there is nothing to do, but if it is `true`, double-click on the option to toggle its value.