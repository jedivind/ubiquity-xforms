<!--
  * Copyright (C) 2008 Backplane Ltd.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  *  http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
-->
<html>
  <head>
    <title>Weather RSS</title>
    <script src="../xH.js" type="text/javascript">/**/</script>
    <script type="text/javascript">

     /*
      * This method will traverse the response XML document and build a
      * simple HTML module comprised of data from the following tags:
      *
      * Data in the first <title> tag in the document.
      * Data in the first <lastBuildDate> tag in the document.
      * HTML from the second <description> tag in the document.
      *
      */

      function successHandler(o){
        // This is the response display container
        var div = document.getElementById('weatherModule');
        var root = o.responseXML.documentElement;
        var oTitle = root.getElementsByTagName('description')[0].firstChild.nodeValue;
        var oDateTime = root.getElementsByTagName('lastBuildDate')[0].firstChild.nodeValue;
        var descriptionNode = root.getElementsByTagName('description')[1].firstChild.nodeValue;
        
        // Format and display results in the response container.
        div.innerHTML = "<p>" + oTitle + "</p>" + "<p>" + oDateTime + "</p>" + descriptionNode;
      }
        
      /*
      *
      * This is a simple failure handler that will display
      * the HTTP status code and status message if the resource
      * returns a non-2xx code.
      *
      */

      function failureHandler(o){
        div.innerHTML = o.status + " " + o.statusText;
      }

      function getModule(){
        // retrieve the field values for the zip code
        // input and the unit input.
        var oForm = document.getElementById('wForm');
        var sLocation = oForm.elements['zip'].value;
        var sUnit = oForm.elements['unit'].value;
        
        // entryPoint is the base URL
        var sAction = 'http://xml.weather.yahoo.com/forecastrss';
        
        // queryString is the key-value pairs of zip and unit.
        var queryString = encodeURI('?p=' + sLocation + '&amp;' + 'u=' + sUnit);
        var sUrl = sAction + queryString;

        // Initiate the HTTP GET request.
        document.submission.request(
          'GET',
          sUrl,
          null,
          0,
          {
            success:successHandler,
            failure:failureHandler
          }
        );
      }
      </script>
  </head>
  <body>
    <form id="wForm">
      <fieldset>
        <label>Zip Code or Location ID</label> <input type="text" name="zip" value="94089">
          <p>Please enter a U.S. Zip Code or a location ID to get the current temperature.  The default is Zip Code 94089 for Sunnyvale, California; its location ID is: USCA1116.</p>
      </fieldset>
      <fieldset>
        <label>Unit</label> <input type="text" name="unit" length="1" maxlength="1">
          <p>Enter *F* for Fahrenheit or *C* for Celsius temperature unit.
      </fieldset>
      <div id="weatherModule"></div>
      <input type="button" value="Get Weather RSS" onClick="getModule()">
    </form>
  </body>
</html>
