<!--
	// Ubiquity provides a standards-based suite of browser enhancements for
	// building a new generation of internet-related applications.
	//
	// The Ubiquity XForms module adds XForms 1.1 support to the Ubiquity
	// library.
	//
	// Copyright (C) 2008 Backplane Ltd.
	//
	// Licensed under the Apache License, Version 2.0 (the "License");
	// you may not use this file except in compliance with the License.
	// You may obtain a copy of the License at
	//
	//  http://www.apache.org/licenses/LICENSE-2.0
	//
	// Unless required by applicable law or agreed to in writing, software
	// distributed under the License is distributed on an "AS IS" BASIS,
	// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	// See the License for the specific language governing permissions and
	// limitations under the License.
  -->
<html
   xmlns="http://www.w3.org/1999/xhtml"
   xmlns:xf="http://www.w3.org/2002/xforms"
   xmlns:javascript="http://www.w3.org/2002/xforms#inline"
   >
  <head>
	<title>Test xforms-output-format</title>
	<script type="text/javascript" src="../src/ubiquity-loader.js" >/**/</script>
	<script type="text/javascript" src="xforms-output-format.js"></script>
  </head>
  <body>
	<xf:model>
	  <xf:instance>
		<data>
		  <amount>1</amount>
		  <amount>20.00</amount>
		  <amount>-12.01</amount>
		</data>
	  </xf:instance>
	</xf:model>

	<p>This form demonstrates the use of javascript functions within the XPath engine.  All javascript functions are available to the XPath engine through a simple bridge that handles the conversion of data types between XPath and javascript.  Currently, only primitives are allowed to cross the bridge: strings, numbers, and booleans.  The reason for this is two-fold: the DOM interface presented does not present the complete interface, and more importantly mutation of the DOM is not possible.  An exception is made for single-valued nodesets which are passed as a string containing the text value of the node.  If a function call is made that provides a nodeset as an argument false is returned.</p>

	<p>Just as only primitives may be passed to bridged functions, only primitives may be returned.  If a function returns anything other than one of the allowable paramter types a boolean false is returned.</p>

	<p>In order to use briged functions, the QName of the function must include a prefix.  The namespace uri of the prefix must map to http://www.w3.org/2002/xforms#inline.  You can register the prefix by adding xmlns:javascript="http://www.w3.org/2002/xforms#inline" to the html element.  With the namespace prefix registered you may call any javascript function in the global namespace by prefixing the function name with the prefix.  For example if you had a function called "currency", it would be called "javascript:currency".</p>

	<xf:repeat nodeset="amount">
	  <xf:output value=".">
		<xf:label>Unformatted:</xf:label>
	  </xf:output>
	  <xf:output value="javascript:currency(string())">
		<xf:label>String: </xf:label>
	  </xf:output>
	  <xf:output value="javascript:currency(number())">
		<xf:label>Number</xf:label>
	  </xf:output>
	  <hr>
	</xf:repeat>
  </body>
</html>
