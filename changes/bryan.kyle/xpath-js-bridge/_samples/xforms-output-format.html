<!--
	// Ubiquity provides a standards-based suite of browser enhancements for
	// building a new generation of internet-related applications.
	//
	// The Ubiquity XForms module adds XForms 1.1 support to the Ubiquity
	// library.
	//
	// Copyright (C) 2008 Backplane Ltd.
	//
	// Licensed under the Apache License, Version 2.0 (the "License");
	// you may not use this file except in compliance with the License.
	// You may obtain a copy of the License at
	//
	//  http://www.apache.org/licenses/LICENSE-2.0
	//
	// Unless required by applicable law or agreed to in writing, software
	// distributed under the License is distributed on an "AS IS" BASIS,
	// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	// See the License for the specific language governing permissions and
	// limitations under the License.
  -->
<html
   xmlns="http://www.w3.org/1999/xhtml"
   xmlns:xf="http://www.w3.org/2002/xforms"
   >
  <head>
	<title>Test xf:input</title>
	<script type="text/javascript" src="../ubiquity-loader.js" >/**/</script>
	<script>
	  
	  var My = {};
	  My.currency = function(nodeset) {

	    if (!nodeset)
	      return null;

	    // XPath engine only works with nodesets, not single nodes
	    // XNode does not implement textContent
	    var value = nodeset[0].firstChild.nodeValue;
	    if (value)
	      value = '$' + parseFloat(value, 10).toFixed(2);
	  
	    return value;
	  };
	</script>
  </head>
  <body>
	<xf:model>
	  <xf:instance>
		<data xmlns="">
		  <amount>1</amount>
		  <amount>20.00</amount>
		  <amount>-12.01</amount>
		</data>
	  </xf:instance>
	</xf:model>


	<p>This form demonstrates the use of javascript functions within the XPath engine.  All javascript functions are available to the XPath engine through a simple bridge that handles the conversion of data types between XPath and javascript.</p>

	<p>When a function call is made within an XPath expression, the XPath engine first looks through its internally registered functions.  If there is a registered function with the same name as the function being called the internal one is used.  If there is no internal function but there is a function in the javascript namespace with the same name it will be called.</p>

	<p>There is still some work to do to complete the bridge.  For example, function names in some cases can contain period characters which nicely allow one to call a javascript function embedded within an object.  However, as this only works some times an enhancement to the bridge would be to require functions to be uri prefixed.  The namespace URI would take the following form: "javascript:[object[.object]*|global]".  When the bridge goes to invoke a prefixed function the function can be dereferenced from the scheme specific part of the uri.</p>

	<p>For example, when "my:hello()" is within an XPath expression where the namespace uri for my is xmlns:my="javascript:my.xpath.library" the bridge would first attempt to file the global object my.xpath.library in the javascript namespace.  From there, the function hello is dereferenced from the object and if it is an object it will be invoked.</p>

	<p>The idea for the special moniker "global" in the namespace uri would mean any function declared in the javascript global object.</p>

	<hr/>

	<xf:repeat nodeset="amount">
	  <xf:output ref=".">
		<xf:label>Unformatted: </xf:label>
	  </xf:output>
	  <xf:output value="My.currency(.)">
		<xf:label>Formatted: </xf:label>
	  </xf:output>
	  <hr/>
	</xf:repeat>


  </body>
</html>
